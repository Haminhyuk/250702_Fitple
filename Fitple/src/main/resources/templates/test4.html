<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>시/도 시/군/구 선택 및 지도 이동</title>
    <style>
        #map { width: 100%; height: 500px; margin-top: 10px; }
        select { padding: 6px; margin-right: 10px; }
    </style>
</head>
<body>
<select id="sido">
    <option value="">시/도 선택</option>
</select>
<select id="sigungu">
    <option value="">시/군/구 선택</option>
</select>

<div id="map"></div>

<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b8731ae4d4303ec9f32c926ed947ae8d&libraries=services"></script>
<script>
    const vworldKey = '696E63A0-9FC6-36DC-8BAA-9C9E2B6B5384';
    const map = new kakao.maps.Map(document.getElementById('map'), {
        center: new kakao.maps.LatLng(36.5, 127.5),
        level: 13
    });

    // JSONP 요청 함수
    function jsonp(url, callbackName = 'callback') {
        return new Promise((resolve, reject) => {
            const cb = 'cb_' + Math.floor(Math.random() * 10000);
            window[cb] = data => {
                delete window[cb];
                document.body.removeChild(script);
                resolve(data);
            };
            const script = document.createElement('script');
            script.src = `${url}&type=jsonp&${callbackName}=${cb}`;
            script.onerror = reject;
            document.body.appendChild(script);
        });
    }

    // 시/도 목록 불러오기
    function loadSido() {
        const url = `https://api.vworld.kr/req/data?key=${vworldKey}&service=data&request=GetFeature&data=LT_C_ADSIDO_INFO&domain=localhost`;
        jsonp(url).then(data => {
            const list = data.response.result.featureCollection.features;
            const select = document.getElementById('sido');
            list.forEach(f => {
                const code = f.properties.ctprvn_cd;
                const name = f.properties.ctp_kor_nm;
                const option = new Option(name, code);
                select.appendChild(option);
            });
        });
    }

    // 시/군/구 목록 불러오기
    function loadSigungu(sidoCode) {
        const url = `https://api.vworld.kr/req/data?key=${vworldKey}&service=data&request=GetFeature&data=LT_C_ADSIGG_INFO&domain=localhost&attrFilter=sido_cd:=${sidoCode}`;
        jsonp(url).then(data => {
            const list = data.response.result.featureCollection.features;
            const select = document.getElementById('sigungu');
            select.innerHTML = '<option value=\"\">시/군/구 선택</option>';
            list.forEach(f => {
                const code = f.properties.sig_cd;
                const name = f.properties.sig_kor_nm;
                const option = new Option(name, code);
                option.dataset.x = f.geometry.coordinates[0][0][0]; // 중심 x
                option.dataset.y = f.geometry.coordinates[0][0][1]; // 중심 y
                select.appendChild(option);
            });
        });
    }

    // 지도 이동
    function moveMap(lat, lng) {
        const latlng = new kakao.maps.LatLng(lat, lng);
        map.setCenter(latlng);
        map.setLevel(7);
    }

    // 시도 변경 이벤트
    document.getElementById('sido').addEventListener('change', function () {
        const code = this.value;
        if (code) loadSigungu(code);
    });

    // 시군구 선택 시 지도 이동
    document.getElementById('sigungu').addEventListener('change', function () {
        const opt = this.selectedOptions[0];
        if (opt.dataset.y && opt.dataset.x) {
            moveMap(opt.dataset.y, opt.dataset.x);
        }
    });

    loadSido();
</script>
</body>
</html>